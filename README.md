# MongoDB Smart Home Data Management

This repository contains scripts for managing and querying a MongoDB database for a smart home application.

## Scripts Overview

- **populate_users.py**: Generates sample user data with smart home devices and inserts it into MongoDB
- **insert_user_data.py**: Runs queries on the existing data and creates indexes for better performance
- **run_qe_query.py**: Demonstrates how to run queries with MongoDB's Queryable Encryption (if configured)

## Prerequisites

- Python 3.6+
- MongoDB Atlas account or local MongoDB instance
- PyMongo package

## Installation

1. Clone this repository:

   ```bash
   git clone https://github.com/yourusername/mongodb-smart-home.git
   cd mongodb-smart-home
   ```

2. Install required packages:
   ```bash
   pip install -r requirements.txt
   ```

## Configuration

Set up environment variables for MongoDB connection:

```bash
# For Linux/macOS
export MONGODB_URI="cluster0.example.mongodb.net"
export MONGODB_USERNAME="your_username"
export MONGODB_PASSWORD="your_password"

# For Windows
set MONGODB_URI=cluster0.example.mongodb.net
set MONGODB_USERNAME=your_username
set MONGODB_PASSWORD=your_password
```

## Running the Scripts

### 1. Populate the Database

This script generates sample user data with smart home devices and inserts it into MongoDB:

```bash
python populate_users.py
```

The script will:

- Connect to your MongoDB instance
- Clear any existing data in the users collection
- Generate sample user documents with embedded device arrays
- Insert the generated data into the database
- Create indexes for better query performance

You can modify the number of users generated by changing the `num_users` parameter in the `generate_user_data()` function.

### 2. Run Queries

After populating the database, you can run queries using:

```bash
python insert_user_data.py
```

This script will:

- Connect to your MongoDB instance
- Create indexes for better query performance
- Run a sample query to find users over 65 years old in the SoCal region
- Display the results

### 3. Queryable Encryption (Optional)

If you have configured MongoDB's Queryable Encryption, you can run encrypted queries with:

```bash
python run_qe_query.py
```

Note: This requires additional setup for encryption keys and configuration.

## Data Structure

Each user document contains:

- Basic user information (ID, name, email)
- Location data (city, region, zipcode)
- Birthday
- An array of smart home devices with:
  - Brand
  - Model
  - Location
  - Energy consumption metrics

## Troubleshooting

If you encounter connection issues:

1. Verify your MongoDB credentials are correct
2. Ensure your IP address is whitelisted in MongoDB Atlas
3. Check that the connection string format is correct
4. Verify network connectivity to the MongoDB server

## License

This project is licensed under the MIT License - see the LICENSE file for details.
